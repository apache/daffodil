<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<tdml:testSuite suiteName="expressions"
  description="lengthKind explicit and occursCountKind expression"
  xmlns:tdml="http://www.ibm.com/xmlns/dfdl/testData"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:dfdl="http://www.ogf.org/dfdl/dfdl-1.0/"
  xmlns:dfdlx="http://www.ogf.org/dfdl/dfdl-1.0/extensions"
  xmlns:ex="http://example.com"
  xmlns:daf="urn:ogf:dfdl:2013:imp:daffodil.apache.org:2018:ext"
  xmlns:fn="http://www.w3.org/2005/xpath-functions"
  xmlns:nns="no.corresponding.ns"
  defaultRoundTrip="true">

	<tdml:defineSchema
		name="udf-schema-Embedded.dfdl.xsd">
		<xs:include
			schemaLocation="org/apache/daffodil/xsd/DFDLGeneralFormat.dfdl.xsd" />
		<dfdl:format ref="ex:GeneralFormat" lengthKind="delimited" />

		<xs:element name="ns_undeclared" type="xs:string" dfdl:inputValueCalc="{ undeclared:replace('Hello World. I am.', ' ', '_')}"/>

		<xs:element name="ns_declared" type="xs:string" dfdl:inputValueCalc="{ nns:replace('Hello World. I am.', ' ', '_')}"/>

	</tdml:defineSchema>

	<!--  Failing Tests -->
	<tdml:parserTestCase name="udf_undeclaredNamespace"
		root="ns_undeclared" model="udf-schema-Embedded.dfdl.xsd"
		description="Tests when a udf's namespace isn't declared">
		<tdml:document />

		<tdml:errors>
			<tdml:error>Schema Definition Error</tdml:error>
			<tdml:error>no corresponding namespace definition</tdml:error>
		</tdml:errors>
	</tdml:parserTestCase>

<!-- 	<tdml:parserTestCase name="udf_declaredNamespace"
		root="ns_declared" model="udf-schema-Embedded.dfdl.xsd"
		description="Tests when a udf's namespace is declared, but no jars registered">
		<tdml:document />

		<tdml:errors>
			<tdml:error>Schema Definition Error</tdml:error>
			<tdml:error>No UDFs found</tdml:error>
		</tdml:errors>
	</tdml:parserTestCase> -->

	<tdml:parserTestCase name="udf_fnNotFound"
		root="ns_declared" model="udf-schema-Embedded.dfdl.xsd"
		description="Tests when a udf's namespace is declared, jars registered, but no matching function found">
		<tdml:document />

		<tdml:errors>
			<tdml:error>Schema Definition Error</tdml:error>
			<tdml:error>No user declared functions found</tdml:error>
		</tdml:errors>
	</tdml:parserTestCase>

	<tdml:parserTestCase name="udf_argsIncorrect"
		root="ns_declared" model="udf-schema-Embedded.dfdl.xsd"
		description="Tests when a udf's namespace is declared, jars registered, function found, but arguments incorrect">
		<tdml:document />

		<tdml:errors>
			<tdml:error>Schema Definition Error</tdml:error>
			<tdml:error>No user declared functions found</tdml:error>
		</tdml:errors>
	</tdml:parserTestCase>

	<tdml:parserTestCase name="udf_unsupportedParamType"
		root="ns_declared" model="udf-schema-Embedded.dfdl.xsd"
		description="Tests when a udf's namespace is declared, jars registered, function found, but arguments incorrect">
		<tdml:document />

		<tdml:errors>
			<tdml:error>Schema Definition Error</tdml:error>
			<tdml:error>No user declared functions found</tdml:error>
		</tdml:errors>
	</tdml:parserTestCase>

	<!-- Warning? Unsure if this ought to be somewhere else -->
	<tdml:parserTestCase name="udf_unsupportedReturnType"
		root="ns_declared" model="udf-schema-Embedded.dfdl.xsd"
		description="Tests when a udf is missing annotations">
		<tdml:document />

		<tdml:errors>
			<tdml:error>Schema Definition Error</tdml:error>
			<tdml:error>No user declared functions found</tdml:error>
		</tdml:errors>
	</tdml:parserTestCase>


</tdml:testSuite>