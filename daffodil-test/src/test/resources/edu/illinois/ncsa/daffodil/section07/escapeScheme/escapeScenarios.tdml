<?xml version="1.0" encoding="UTF-8"?>
<testSuite suiteName="escapeScheme" xmlns="http://www.ibm.com/xmlns/dfdl/testData"
  xmlns:tns="http://example.com" xmlns:ct="http://w3.ibm.com/xmlns/dfdl/ctInfoset"
  xmlns:dfdl="http://www.ogf.org/dfdl/dfdl-1.0/" xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <defineSchema name="es1">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" />

    <dfdl:defineEscapeScheme name="scenario1">
      <dfdl:escapeScheme escapeCharacter='/'
        escapeKind="escapeCharacter" escapeEscapeCharacter="/" />
    </dfdl:defineEscapeScheme>
   
    <xs:element name="e_infix">
      <xs:complexType>
        <xs:sequence dfdl:separator=";" dfdl:separatorPosition="infix">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario1" />
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario1" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

    <xs:element name="e_postfix">
      <xs:complexType>
        <xs:sequence dfdl:separator=";" dfdl:separatorPosition="postfix">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario1" />
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario1" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

  </defineSchema>
  
  <defineSchema name="es1-2">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" documentFinalTerminatorCanBeMissing="no"/>

    <dfdl:defineEscapeScheme name="scenario1">
      <dfdl:escapeScheme escapeCharacter='/'
        escapeKind="escapeCharacter" escapeEscapeCharacter="/" />
    </dfdl:defineEscapeScheme>
   
    <xs:element name="e">
      <xs:complexType>
        <xs:sequence dfdl:separator="">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario1" dfdl:terminator=";"/>
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario1" dfdl:terminator=";" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

  </defineSchema>
  
  <parserTestCase name="scenario1_1" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>

  <parserTestCase name="scenario1_2" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foobar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_3" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_4" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo//;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_5" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo///bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_6" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo///;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_7" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo</x>
	  <y></y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_7_postfix" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo;</document>
    <infoset>
      <dfdlInfoset>
        <e_postfix>
          <x>foo</x>
	</e_postfix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_8" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo;</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_8_req_term" model="es1-2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e">
    <document>foo/;</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>
  
  <parserTestCase name="scenario1_9" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/;;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo;</x>
	  <y></y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_9_postfix" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo/;;</document>
    <infoset>
      <dfdlInfoset>
        <e_postfix>
          <x>foo;</x>
	</e_postfix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_10" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo//;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/</x>
	  <y></y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_10_postfix" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo//;</document>
    <infoset>
      <dfdlInfoset>
        <e_postfix>
          <x>foo/</x>
	</e_postfix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_11" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo///;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/;</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_11_postfix" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo///;</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>
  
  <parserTestCase name="scenario1_12" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_12_postfix" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo/</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>
  
  <parserTestCase name="scenario1_13" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo///</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario1_13_postfix" model="es1"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo///</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>
  
  <defineSchema name="es2">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" />

    <dfdl:defineEscapeScheme name="scenario2">
      <dfdl:escapeScheme escapeCharacter='/'
        escapeKind="escapeCharacter" escapeEscapeCharacter="$" />
    </dfdl:defineEscapeScheme>
   
    <xs:element name="e_infix">
      <xs:complexType>
        <xs:sequence dfdl:separator="$;" dfdl:separatorPosition="infix">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario2" />
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario2" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

    <xs:element name="e_postfix">
      <xs:complexType>
        <xs:sequence dfdl:separator="$;" dfdl:separatorPosition="postfix">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario2" />
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario2" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

  </defineSchema>
  
  <defineSchema name="es2-2">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" documentFinalTerminatorCanBeMissing="no"/>

    <dfdl:defineEscapeScheme name="scenario2">
      <dfdl:escapeScheme escapeCharacter='/'
        escapeKind="escapeCharacter" escapeEscapeCharacter="$" />
    </dfdl:defineEscapeScheme>
   
    <xs:element name="e">
      <xs:complexType>
        <xs:sequence dfdl:separator="">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario2" dfdl:terminator="$;"/>
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario2" dfdl:terminator="$;" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

  </defineSchema>
  
  <parserTestCase name="scenario2_1" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
 
  <parserTestCase name="scenario2_2" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/$;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo$;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_3" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$/$;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_4" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$$;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo$</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_5" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo//$;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo$;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_6" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo//////////bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foobar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_7" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$$$$$bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo$$$$$bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_8" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$//;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_9" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$/$$;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/$</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_10" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo</x>
	  <y></y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_10_postfix" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo$;</document>
    <infoset>
      <dfdlInfoset>
        <e_postfix>
          <x>foo</x>
	</e_postfix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_11" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/$;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo$;</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_11_req_term" model="es2-2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e">
    <document>foo/$;</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>
  
  <parserTestCase name="scenario2_12" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$/$;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/</x>
	  <y></y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_12_postfix" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo$/$;</document>
    <infoset>
      <dfdlInfoset>
        <e_postfix>
          <x>foo/</x>
	</e_postfix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_13" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$$/$;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo$/</x>
	  <y></y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_13_postfix" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo$$/$;</document>
    <infoset>
      <dfdlInfoset>
        <e_postfix>
          <x>foo$/</x>
	</e_postfix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario2_14" model="es2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$$$//$;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo$$/$;</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>

  <!-- This does get a parse error but it's a bit confusing - 'Delimiter not found!  Was looking for ($;) but found "$;" instead.' -->
  <parserTestCase name="scenario2_14_req_term" model="es2-2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e">
    <document>foo$$$//$;</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>

  <defineSchema name="es3">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" />

    <dfdl:defineEscapeScheme name="scenario3">
      <dfdl:escapeScheme escapeCharacter='/'
        escapeKind="escapeCharacter" escapeEscapeCharacter="$" />
    </dfdl:defineEscapeScheme>
   
    <xs:element name="e_infix">
      <xs:complexType>
        <xs:sequence dfdl:separator="/;" dfdl:separatorPosition="infix">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario3" />
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario3" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

    <xs:element name="e_postfix">
      <xs:complexType>
        <xs:sequence dfdl:separator="/;" dfdl:separatorPosition="postfix">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario3" />
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario3" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

  </defineSchema>
  
  <defineSchema name="es3-2">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" documentFinalTerminatorCanBeMissing="no"/>

    <dfdl:defineEscapeScheme name="scenario3">
      <dfdl:escapeScheme escapeCharacter='/'
        escapeKind="escapeCharacter" escapeEscapeCharacter="$" />
    </dfdl:defineEscapeScheme>
   
    <xs:element name="e">
      <xs:complexType>
        <xs:sequence dfdl:separator="">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario3" dfdl:terminator="/;"/>
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario3" dfdl:terminator="/;" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

  </defineSchema>
  
  <parserTestCase name="scenario3_1" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_2" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$/;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_3" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$$/;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo$/;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_4" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo//;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_5" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo///;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_6" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$//;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_7" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$///;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo//;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_8" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$////;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo//</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_9" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$///////;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo////;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_10" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo</x>
	  <y></y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_10_postfix" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo/;</document>
    <infoset>
      <dfdlInfoset>
        <e_postfix>
          <x>foo</x>
	</e_postfix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_11" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$/;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/;</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_11_postfix" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo$/;</document>
    <infoset>
      <dfdlInfoset>
        <e_postfix>
          <x>foo/;</x>
	</e_postfix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_12" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$$/;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo$/;</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_12_req_term" model="es3-2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e">
    <document>foo$$/;</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>
  
  <parserTestCase name="scenario3_13" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$//;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/</x>
	  <y></y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_13_postfix" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo$//;</document>
    <infoset>
      <dfdlInfoset>
        <e_postfix>
          <x>foo/</x>
	</e_postfix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_14" model="es3"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo$/$/$/;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo///;</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario3_14_req_term" model="es3-2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e">
    <document>foo$/$/$/;</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>

  <defineSchema name="es4">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" />

    <dfdl:defineEscapeScheme name="scenario4">
      <dfdl:escapeScheme escapeCharacter='/'
        escapeKind="escapeCharacter" escapeEscapeCharacter="/" />
    </dfdl:defineEscapeScheme>
   
    <xs:element name="e_infix">
      <xs:complexType>
        <xs:sequence dfdl:separator="/;" dfdl:separatorPosition="infix">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario4" />
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario4" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

    <xs:element name="e_postfix">
      <xs:complexType>
        <xs:sequence dfdl:separator="/;" dfdl:separatorPosition="postfix">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario4" />
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario4" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

  </defineSchema>
  
  <defineSchema name="es4-2">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" documentFinalTerminatorCanBeMissing="no"/>

    <dfdl:defineEscapeScheme name="scenario4">
      <dfdl:escapeScheme escapeCharacter='/'
        escapeKind="escapeCharacter" escapeEscapeCharacter="/" />
    </dfdl:defineEscapeScheme>
    
    <xs:element name="e">
      <xs:complexType>
        <xs:sequence dfdl:separator="">
          <xs:element name="x" type="xs:string" dfdl:escapeSchemeRef="tns:scenario4" dfdl:terminator="/;"/>
          <xs:element name="y" type="xs:string" minOccurs="0" dfdl:escapeSchemeRef="tns:scenario4" dfdl:terminator="/;" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

  </defineSchema>
  
  
  <parserTestCase name="scenario4_1" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_2" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo//;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_3" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo///;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_4" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo////bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo//bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_5" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo////;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo//;bar</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_6" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/////;bar</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo//</x>
	  <y>bar</y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_7" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_7_req_term" model="es4-2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e">
    <document>foo</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>
  
  <parserTestCase name="scenario4_8" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo/;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo</x>
	  <y></y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_8_postfix" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo/;</document>
    <infoset>
      <dfdlInfoset>
        <e_postfix>
          <x>foo</x>
	</e_postfix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_9" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo//;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/;</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_9_req_term" model="es4-2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e">
    <document>foo//;</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>
  
  <parserTestCase name="scenario4_10" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo///</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_10_req_term" model="es4-2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e">
    <document>foo///</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>
  
  <parserTestCase name="scenario4_11" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo///;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo/</x>
	  <y></y>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_11_postfix" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_postfix">
    <document>foo///;</document>
    <infoset>
      <dfdlInfoset>
        <e_postfix>
          <x>foo/</x>
	</e_postfix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_12" model="es4"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e_infix">
    <document>foo////;</document>
    <infoset>
      <dfdlInfoset>
        <e_infix>
          <x>foo//;</x>
	</e_infix>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>
  
  <parserTestCase name="scenario4_12_req_term" model="es4-2"
    description="Section 13 - escapeCharacter - DFDL-13-029R" root="e">
    <document>foo////;</document>
    <errors>
      <error>Parse Error</error>
    </errors>
  </parserTestCase>
  
</testSuite>
